@using HorsesForCourses.MVC.Models.Coaches;
@using HorsesForCourses.Service;

@model EditCoachSkillsViewModel

<h2>Edit Coach @Model.CoachId</h2>

<form asp-controller="CoachMVC" asp-action="EditSkills" method="post" id="editForm">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="CoachId" />

    <div id="skills-list">
        @for (int i = 0; i < Model.Skills.Count; i++)
        {
            <div class="skill-item">
                <input type="hidden" name="Skills[@i]" value="@Model.Skills[i]" />
                <span>@Model.Skills[i]</span>
                <button type="button" class="btn btn-danger btn-sm" onclick="removeSkill(this)">Remove</button>
            </div>
        }
    </div>

    <div class="input-group mt-3">
        <input type="text" id="newSkillInput" placeholder="Add a skill" class="form-control" />
        <button type="button" class="btn btn-success" onclick="addSkill()">Add</button>
    </div>

    <button type="submit" class="btn btn-primary mt-3">Save Changes</button>
</form>

<script>
    function removeSkill(button) {
        button.closest('.skill-item').remove();
        reindexSkills();
    }

    function addSkill() {
        const input = document.getElementById('newSkillInput');
        const skill = input.value.trim();
        if (!skill) return;

        const container = document.getElementById('skills-list');
        const index = container.children.length;

        const div = document.createElement('div');
        div.className = 'skill-item';
        div.innerHTML = `
            <input type="hidden" name="Skills[${index}]" value="${skill}" />
            <span>${skill}</span>
            <button type="button" class="btn btn-danger btn-sm" onclick="removeSkill(this)">Remove</button>
        `;
        container.appendChild(div);

        input.value = '';
        reindexSkills();
    }

    function reindexSkills() {
        const items = document.querySelectorAll('#skills-list .skill-item');
        items.forEach((el, i) => {
            const hiddenInput = el.querySelector('input[type="hidden"]');
            hiddenInput.name = `Skills[${i}]`;
        });
    }
</script>